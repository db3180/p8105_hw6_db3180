---
title: "p8105_hw6"
author: "Divya Bisht"
date: "11/24/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(purrr)
library(rvest)
library(modelr)
```

# Problem 1
```{r}
homicide_wp = 
  read_csv(
    "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state, sep = ", ")) %>%
  mutate(solved = as.numeric(disposition == "Closed by arrest"), 
         victim_age = as.numeric(victim_age)) %>%  
  filter(!city_state == "Dallas, TX", !city_state == "Phoenix, AZ", 
         !city_state == "Kansas City, MO", !city_state == "Tulsa, AL") %>% 
  
  mutate(victim_race = ifelse(victim_race == "White", "White", "Non-White"),
                            fct_relevel(victim_race, "White", "Non-White"))
```

Baltimore only
```{r}
baltimore_homicide = 
  homicide_wp %>%
  filter(city == "Baltimore") %>% 
  select(solved, victim_age, victim_race, victim_sex)
```

```{r}
baltimore_logistic = 
  glm(solved ~ victim_age + victim_sex + victim_race, 
    data = baltimore_homicide, 
    family = binomial())
```

```{r}
baltimore_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate), 
        conf.low = exp(estimate - 1.96*std.error),
        conf.high = exp(estimate + 1.96*std.error)) %>%
  filter(term == "victim_raceWhite") %>%       
  knitr::kable(digits = 3)
  
```

GLM for each city

```{r}
  homicide_wp %>% 
  group_by(city_state) %>% 
  nest() %>%
  mutate(model = map(data, ~glm(solved ~ victim_age + victim_sex + victim_race, 
    data = ., family = binomial()))) %>% 
  unnest() %>%
  gather()
  
```

Plot
```{r}
all_cities_nested %>% 
  ggplot(aes())
```

Now run glm for each of the cities in your dataset, and extract the adjusted odds ratio (and CI) for solving homicides comparing non-white victims to white victims. Do this within a “tidy” pipeline, making use of purrr::map, list columns, and unnest as necessary to create a dataframe with estimated ORs and CIs for each city.

Create a plot that shows the estimated ORs and CIs for each city. Organize cities according to estimated OR, and comment on the plot.

## Problem 2
```{r}
birth_data = read_csv("./birthweight.csv") %>% 
    janitor::clean_names() %>%
    mutate(babysex = as.factor(babysex), mrace = as.factor(mrace), race = as.factor(frace)) %>%

```

Regression model: 
```{r}
birth_data %>% 
  ggplot(aes(x = bwt)) +  
         geom_point()

#what 
```

Two plots you have to show in addition to your proposed regression model for birthweight: 

- One using length at birth and gestational age as predictors (main effects only)
- One using head circumference, length, sex, and all interactions (including the three-way interaction) between these


